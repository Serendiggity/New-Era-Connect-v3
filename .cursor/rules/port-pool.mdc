---
alwaysApply: true
---

## ðŸ”’ Port Pool Rule â€” Agent-aware

> Two primary AIs can run in parallel without collisions; one spare slot remains.

### 1 â–ª Port Map

| Slot | Agent (preferred) | FE | BE | MCP Range |
|------|-------------------|----|----|-----------|
| A    | **Cursor**        | 3000 | 8000 | 8100-8119 |
| B    | **Claude Code**   | 3002 | 8002 | 8120-8139 |
| C    | Any / overflow    | 3004 | 8004 | 8140-8159 |

### 2 â–ª Claim protocol

1. **Agent looks for its preferred slot** in `ports.log`.  
2. If the slot is **free**, append a line:  
   `<FE> <BE> <branch> <PID> <AGENT_SELF> <ISO-time>`

```bash
# Example
echo "3002 8002 feat/ocr-flow $$ $AGENT_SELF $(date -Iseconds)" >> ports.log
```

3. If preferred slot busy, check the others in order A â†’ B â†’ C.  
4. If all three busy, ask user whether to kill the oldest PID.

### 3 â–ª Start servers

```bash
export PORT=<FE> API_PORT=<BE>
echo "ðŸ”§ $AGENT_SELF using PORT=$PORT  API_PORT=$API_PORT  (slot $(Slot))"
npm run dev   # or next dev, vite, uvicorn, etc.
```

### 4 â–ª Release slot on exit
Remove your own line-entry from ports.log (match by PID).

### 5 â–ª MCP Server Management

```bash
# Check MCP server status
lsof -i :8120-8139 | grep LISTEN

# Start MCP servers with proper port allocation
export MCP_PORT_BASE=8120  # For Claude Code slot B
export MCP_DEBUG=1
claude --mcp-port $MCP_PORT_BASE
```

### 6 â–ª Multi-Agent Coordination

When both agents run simultaneously:
- **Shared Development**: Both use same branch, coordinate via git
- **Resource Allocation**: Monitor memory usage with `free -h`
- **Terminal Sessions**: Claude Code runs in Cursor terminal for best integration
- **Port Conflicts**: Use `netstat -tulpn | grep :80` to check conflicts

### 7 â–ª Safety guard
Before killing any PID, confirm it belongs to the repo path or ask the user.

*END*
